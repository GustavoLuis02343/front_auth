<div class="setup-container">
  <!-- Paso 1: Escanear QR (DIRECTO) -->
  <div *ngIf="paso === 1" class="setup-card">
    <div class="header-section">
      <h2>ğŸ” Configura tu autenticaciÃ³n</h2>
      <p class="subtitle">Escanea el cÃ³digo QR con tu aplicaciÃ³n autenticadora</p>
    </div>

    <div class="qr-section" *ngIf="!cargando">
      <div class="qr-container">
        <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" *ngIf="qrCodeUrl" />
        <div class="qr-placeholder" *ngIf="!qrCodeUrl">
          <span class="loader">â³</span>
        </div>
      </div>
      
      <div class="apps-info">
        <p class="apps-title">ğŸ“± Aplicaciones compatibles:</p>
        <ul class="apps-list">
          <li>Google Authenticator</li>
          <li>Microsoft Authenticator</li>
          <li>Authy</li>
          <li>1Password</li>
        </ul>
      </div>

      <div class="manual-code">
        <p class="manual-title"><strong>Â¿No puedes escanear?</strong></p>
        <p class="manual-subtitle">Ingresa este cÃ³digo manualmente en tu app:</p>
        <div class="secret-code-container">
          <code class="secret-code">{{ secreto }}</code>
          <button (click)="copiarSecreto()" class="btn-copy" title="Copiar cÃ³digo">
            ğŸ“‹
          </button>
        </div>
      </div>
    </div>

    <div class="loading-state" *ngIf="cargando">
      <div class="spinner"></div>
      <p>Generando cÃ³digo QR...</p>
    </div>

    <div class="actions">
      <button 
        (click)="irAVerificacion()" 
        class="btn btn-primary"
        [disabled]="cargando || !qrCodeUrl"
      >
        Ya escaneÃ© el cÃ³digo â†’
      </button>
      
      <button (click)="volver()" class="btn btn-secondary">
        â† Volver al dashboard
      </button>
    </div>

    <p *ngIf="mensaje && paso === 1" [ngClass]="{'error': isError, 'success': !isError}" class="message">
      {{ mensaje }}
    </p>
  </div>

  <!-- Paso 2: Verificar cÃ³digo -->
  <div *ngIf="paso === 2" class="setup-card">
    <div class="header-section">
      <h2>ğŸ”¢ Verifica tu cÃ³digo</h2>
      <p class="subtitle">
        Ingresa el cÃ³digo de 6 dÃ­gitos que aparece en tu aplicaciÃ³n
      </p>
    </div>

    <div class="verification-section">
      <div class="code-input-container">
        <input 
          type="text" 
          class="code-input"
          [(ngModel)]="codigoVerificacion"
          placeholder="000000"
          maxlength="6"
          pattern="[0-9]*"
          (input)="validarSoloNumeros($event)"
          autofocus
        />
        <span class="input-hint">{{ codigoVerificacion.length }}/6</span>
      </div>

      <div class="verification-info">
        <p class="info-text">
          ğŸ’¡ <strong>Tip:</strong> El cÃ³digo cambia cada 30 segundos
        </p>
      </div>

      <div class="actions">
        <button 
          (click)="verificarCodigo()" 
          class="btn btn-primary"
          [disabled]="codigoVerificacion.length !== 6 || cargando"
        >
          <span *ngIf="!cargando">Verificar y Activar âœ“</span>
          <span *ngIf="cargando">Verificando...</span>
        </button>

        <button (click)="volverAlQR()" class="btn btn-secondary">
          â† Ver QR nuevamente
        </button>
      </div>

      <p *ngIf="mensaje" [ngClass]="{'error': isError, 'success': !isError}" class="message">
        {{ mensaje }}
      </p>
    </div>
  </div>
</div>